import{d as o,k as l,f as e,r as d,o as ae,z as h,c as F,a as oe,e as M,i as S,j as le,t as a,v as T,n as _,F as j,l as O,m as P,q as R,h as b,u as p,E as de}from"./app-DogBUM30.js";import{C as ne,Y as ie,G as ue,V as ce,S as ge}from"./CustomerLayout-C6TKXWdm.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ve(i,u){return o(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"})])}function Z(i,u){return o(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})])}const ye={key:0,id:"modal",class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300 ease-in-out"},me={class:"bg-white rounded-2xl shadow-lg p-6 w-full max-w-md transform transition-all duration-300 scale-95 animate-fadeIn text-gray-700"},xe={key:0,class:"mt-4"},be={class:"block mb-2 text-sm font-medium"},pe={class:"mt-6 flex justify-end"},fe={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ke={key:0,class:"mb-4 p-4 bg-red-100 dark:bg-red-900/50 border border-red-400 text-red-700 dark:text-red-300 rounded"},he={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},_e={class:"lg:col-span-2 space-y-6"},we={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ce={class:"flex justify-between items-center mb-4"},Ae={class:"text-lg font-medium text-orange-600 dark:text-orange-400"},Me={key:0,class:"space-y-4"},Se={class:"text-gray-900 dark:text-gray-200 font-medium"},Pe={class:"text-sm text-gray-600 dark:text-gray-400"},je={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},Oe={class:"text-gray-900 dark:text-gray-200"},Ne={key:1,class:"text-gray-600 dark:text-gray-400 text-center py-4"},Ie={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},De=["onClick"],ze={class:"flex items-start space-x-3"},Be={class:"text-gray-900 dark:text-gray-200 font-medium"},Ee={class:"text-sm text-gray-600 dark:text-gray-400"},Fe={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Te={class:"flex items-start space-x-3"},qe={class:"text-gray-900 dark:text-gray-200 font-medium"},Ue={class:"text-sm text-gray-600 dark:text-gray-400"},$e={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Le=["onClick"],Re={class:"text-gray-900 dark:text-gray-200 capitalize"},Ze={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ge={class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},Je={class:"lg:col-span-1"},He={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 sticky top-4"},Qe={class:"space-y-3"},We={class:"flex justify-between text-gray-600 dark:text-gray-300"},Ke={key:0,class:"flex justify-between text-gray-600 dark:text-gray-300"},Xe={class:"border-t border-gray-200 dark:border-gray-700 pt-3"},et={class:"flex justify-between text-lg font-semibold text-gray-900 dark:text-gray-100"},tt=["disabled"],rt={key:0,class:"mt-3 text-sm text-red-600 dark:text-red-400 text-center"},st={class:"fixed inset-0 overflow-y-auto"},at={class:"flex min-h-full items-center justify-center p-4"},ot={class:"mt-4 space-y-4"},lt={class:"flex items-center"},ut={__name:"Checkout",props:{auth:Object,addresses:{type:Array,default:()=>[]},branch:{type:Object,required:!0,validator:i=>i&&typeof i.id<"u"}},setup(i){const u=i,N=d(!1),f=d(null),I=d(""),v=d([]),n=d(JSON.parse(localStorage.getItem("selectedItem")).order_type),x=d(null),k=d("mobile"),G=d(""),V=d(!1),w=d(!1),q=d({}),c=d({}),y=d({address_label:"",address:"",latitude:null,longitude:null,is_default:!1});ae(()=>{H(),n.value==="delivery"&&J()});const J=()=>{var s;if(((s=u.addresses)==null?void 0:s.length)>0){const t=u.addresses.find(r=>r.is_default)||u.addresses[0];x.value=t}},H=()=>{var s;console.log(n.value,"focus");try{const t=localStorage.getItem("selectedItem");if(!t){C();return}const r=JSON.parse(t);if(console.log("Cart Data:",r),!r||!r.items||!Array.isArray(r.items)){console.log("Invalid cart data structure"),sessionStorage.removeItem("foodCart"),C();return}if(!((s=u.branch)!=null&&s.id)){console.log("Branch data is missing"),C();return}if(Number(r.items[0].branch_id)!==Number(u.branch.id)){console.log("Cart belongs to a different branch"),C();return}v.value=r.items,console.log("cart itmes",v.value),n.value=r.order_type,console.log("Order Type set to:",n.value)}catch(t){console.error("Error loading cart:",t),U("Error loading cart data"),sessionStorage.removeItem("foodCart"),C()}},C=()=>{var s;(s=u.branch)!=null&&s.id?h.visit(route("customer.branch.menu",{branch:u.branch.id})):h.visit("/")},U=s=>{q.value={message:s},setTimeout(()=>{q.value={}},5e3)},A=F(()=>{var s;return(s=v.value)!=null&&s.length?v.value.reduce((t,r)=>t+Number(r.total),0):0}),D=F(()=>n.value==="delivery"?2.99:0),$=F(()=>{const s=A.value;return n.value==="delivery"?s+D.value:s}),Q=()=>n.value==="delivery"&&!x.value?(c.value.address="Please select a delivery address",!1):!0,W=()=>k.value?!0:(c.value.payment="Please select a payment method",!1),K=()=>{var s;return(s=v.value)!=null&&s.length?!0:(c.value.cart="Your cart is empty",!1)},X=()=>{const s=u.branch.minimum_order||0;return A.value<s?(c.value.minimum=`Minimum order amount is £${s}`,!1):!0},Y=()=>{var r,m,B;const s={order_type:n.value,branch_id:u.branch.id,items:v.value.map(g=>({food_id:g.id,quantity:g.qty,special_instructions:g.instructions||"",unit_price:g.base_price,subtotal:g.total})),payment_method:k.value==="mobile"?f.value:k.value,paymentRef:I.value,subtotal:A.value,total_amount:$.value};c.value={},K()&&Q()&&W()&&X()&&(w.value=!0,n.value==="delivery"&&(s.delivery_address=(r=x.value)==null?void 0:r.address,s.delivery_latitude=(m=x.value)==null?void 0:m.latitude,s.delivery_longitude=(B=x.value)==null?void 0:B.longitude,s.delivery_notes=G.value,s.delivery_fee=D.value),console.log("Submitting order:",s),h.post(route("customer.orders.store"),s,{onSuccess:g=>{localStorage.removeItem("selectedItem");const E=g.url.split("/");console.log(E);const L=E[E.length-1];L?h.visit(route("customer.orders.show",{order:L})):(U("Failed to process order. Please try again."),w.value=!1)},onError:g=>{console.error("Error:",g),w.value=!1,c.value=g}}))},ee=()=>{k.value!="mobile"?Y():N.value=!0},te=()=>{V.value=!0},z=()=>{V.value=!1,y.value={address_label:"",address:"",latitude:null,longitude:null,is_default:!1},c.value={}},re=()=>{h.post(route("customer.addresses.store"),y.value,{onSuccess:()=>{z(),h.reload({only:["addresses"]})},onError:s=>{c.value=s}})},se=s=>new Intl.NumberFormat("en-BD",{style:"currency",currency:"BDT",minimumFractionDigits:2}).format(Number(s));return(s,t)=>(o(),oe(ne,null,{default:M(()=>[N.value?(o(),l("div",ye,[e("div",me,[t[7]||(t[7]=e("h2",{class:"text-xl font-semibold mb-4 text-center"},"Complete Payment",-1)),t[8]||(t[8]=e("label",{class:"block mb-2 text-sm font-medium"},"Choice Payment Method",-1)),S(e("select",{"onUpdate:modelValue":t[0]||(t[0]=r=>f.value=r),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"},t[6]||(t[6]=[e("option",{value:""},"Choose an option",-1),e("option",{value:"bikash"},"Bikash",-1),e("option",{value:"nogod"},"Nogod",-1),e("option",{value:"rocket"},"Rocket",-1)]),512),[[le,f.value]]),f.value?(o(),l("div",xe,[e("p",null,"Pay to following "+a(f.value)+" number: 0122514244225",1),e("div",null,[e("label",be,"Enter "+a(f.value)+" reference number:",1),S(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=r=>I.value=r)},null,512),[[T,I.value]])])])):_("",!0),e("div",pe,[e("button",{onClick:t[2]||(t[2]=r=>N.value=!1),class:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition"},"Close"),e("button",{onClick:Y,class:"ml-3 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"},"Complete Payment")])])])):_("",!0),e("div",fe,[Object.keys(c.value).length>0?(o(),l("div",ke,[(o(!0),l(j,null,O(c.value,(r,m)=>(o(),l("p",{key:m},a(r),1))),128))])):_("",!0),e("div",he,[e("div",_e,[e("div",we,[e("div",Ce,[t[9]||(t[9]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Order Summary",-1)),e("div",Ae,a(n.value==="delivery"?"Delivery Order":"Collection Order"),1)]),v.value.length?(o(),l("div",Me,[(o(!0),l(j,null,O(v.value,r=>(o(),l("div",{key:r.id,class:"flex justify-between items-start border-b border-gray-200 dark:border-gray-700 pb-4"},[e("div",null,[e("h3",Se,a(r.name),1),e("p",Pe,"Quantity: "+a(r.qty),1),r.instructions?(o(),l("p",je,"Note: "+a(r.instructions),1)):_("",!0)]),e("span",Oe,[t[10]||(t[10]=e("span",{style:{"font-size":"30px"}},"৳",-1)),P(" "+a(r.total),1)])]))),128))])):(o(),l("div",Ne,"Your cart is empty"))]),e("div",Ie,[e("div",{class:"flex justify-between items-center mb-4"},[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Delivery Address",-1)),e("button",{onClick:te,class:"text-orange-600 dark:text-orange-400 hover:text-orange-700 dark:hover:text-orange-300"},"+ Add New Address")]),e("div",Ve,[(o(!0),l(j,null,O(i.addresses,r=>{var m;return o(),l("div",{key:r.id,onClick:B=>x.value=r,class:R(["border rounded-lg p-4 cursor-pointer transition-colors duration-200",[((m=x.value)==null?void 0:m.id)===r.id?"border-orange-500 bg-orange-50 dark:bg-gray-700":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600"]])},[e("div",ze,[b(p(Z),{class:"w-5 h-5 text-gray-400 flex-shrink-0"}),e("div",null,[e("p",Be,a(r.address_label),1),e("p",Ee,a(r.address),1)])])],10,De)}),128))])]),e("div",Fe,[t[13]||(t[13]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},"Food Provider",-1)),e("div",Te,[b(p(Z),{class:"w-5 h-5 text-gray-400 flex-shrink-0"}),e("div",null,[e("p",qe,a(i.branch.name),1),e("p",Ue,a(i.branch.address),1),t[12]||(t[12]=e("p",{class:"mt-2 text-sm text-orange-600"},"Please collect your order from this location",-1))])])]),e("div",$e,[t[14]||(t[14]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},"Payment Method",-1)),e("div",Ye,[(o(),l(j,null,O(["cash","mobile"],r=>e("button",{key:r,onClick:m=>k.value=r,class:R(["flex items-center space-x-3 border rounded-lg p-4 transition-colors duration-200",[k.value===r?"border-orange-500 bg-orange-50 dark:bg-gray-700":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600"]])},[b(p(ve),{class:"w-5 h-5 text-gray-400"}),e("span",Re,a(r=="cash"?r:"Mobile Payment"),1)],10,Le)),64))])]),e("div",Ze,[e("h2",Ge,a(n.value==="delivery"?"Delivery Instructions":"Instructions"),1)])]),e("div",Je,[e("div",He,[t[21]||(t[21]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4"},"Order Total",-1)),e("div",Qe,[e("div",We,[t[16]||(t[16]=e("span",null,"Subtotal",-1)),e("span",null,[t[15]||(t[15]=e("span",{style:{"font-size":"30px"}},"৳",-1)),P(" "+a(A.value),1)])]),n.value==="delivery"?(o(),l("div",Ke,[t[18]||(t[18]=e("span",null,"Delivery Fee",-1)),e("span",null,[t[17]||(t[17]=e("span",{style:{"font-size":"30px"}},"৳",-1)),P(" "+a(D.value),1)])])):_("",!0),e("div",Xe,[e("div",et,[t[20]||(t[20]=e("span",null,"Total",-1)),e("span",null,[t[19]||(t[19]=e("span",{style:{"font-size":"30px"}},"৳",-1)),P(" "+a($.value),1)])])])]),e("button",{onClick:ee,disabled:w.value||!v.value.length,class:"w-full mt-6 bg-orange-600 text-white py-3 px-4 rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},a(w.value?"Processing...":"Place Order"),9,tt),A.value<(i.branch.minimum_order||0)?(o(),l("div",rt,"Minimum order amount is "+a(se(i.branch.minimum_order)),1)):_("",!0)])])])]),b(p(ge),{appear:"",show:V.value,as:"template"},{default:M(()=>[b(p(ie),{as:"div",onClose:z,class:"relative z-50"},{default:M(()=>[t[26]||(t[26]=e("div",{class:"fixed inset-0 bg-black/50"},null,-1)),e("div",st,[e("div",at,[b(p(ue),{class:"w-full max-w-md transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 p-6 text-left align-middle shadow-xl transition-all"},{default:M(()=>[b(p(ce),{as:"h3",class:"text-lg font-medium text-gray-900 dark:text-gray-100"},{default:M(()=>t[22]||(t[22]=[P("Add New Address")])),_:1}),e("div",ot,[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Address Label ",-1)),S(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=r=>y.value.address_label=r),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200",placeholder:"Home, Work, etc."},null,512),[[T,y.value.address_label]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Full Address ",-1)),S(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=r=>y.value.address=r),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"},null,512),[[T,y.value.address]])]),e("div",lt,[S(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=r=>y.value.is_default=r),class:"rounded border-gray-300 dark:border-gray-600 text-orange-600 focus:ring-orange-500"},null,512),[[de,y.value.is_default]]),t[25]||(t[25]=e("label",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"}," Set as default address ",-1))])]),e("div",{class:"mt-6 flex justify-end space-x-3"},[e("button",{onClick:z,class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"},"Cancel"),e("button",{onClick:re,class:"px-4 py-2 text-sm bg-orange-600 text-white rounded-md hover:bg-orange-700 transition-colors duration-200"},"Save Address")])]),_:1})])])]),_:1})]),_:1},8,["show"])]),_:1}))}};export{ut as default};
